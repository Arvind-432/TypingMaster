<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeMaster Pro - Advanced Typing Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- FIXED: Working jsPDF CDN link -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06d6a0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --dark-color: #0f172a;
            --light-color: #f8fafc;
            --gray-color: #64748b;
            --border-color: #e2e8f0;
            --card-bg: rgba(255, 255, 255, 0.85);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: var(--dark-color);
            overflow-x: hidden;
        }

        .background-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .bg-circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 6s ease-in-out infinite;
        }

        .bg-circle:nth-child(1) {
            width: 200px;
            height: 200px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .bg-circle:nth-child(2) {
            width: 150px;
            height: 150px;
            top: 60%;
            right: 15%;
            animation-delay: 2s;
        }

        .bg-circle:nth-child(3) {
            width: 100px;
            height: 100px;
            bottom: 20%;
            left: 20%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 25px 35px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo h1 {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav {
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 12px;
        }

        .nav-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: var(--gray-color);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        /* Sections */
        .section {
            display: none;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
        }

        .section.active {
            display: block;
            animation: slideInUp 0.6s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .test-header h2 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .test-header p {
            font-size: 1.2rem;
            color: var(--gray-color);
            font-weight: 500;
        }

        /* Test Controls */
        .test-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--glass-bg);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1rem;
        }

        .control-group select {
            padding: 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: white;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .control-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Typing Area */
        .typing-area {
            max-width: 900px;
            margin: 0 auto;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .stat {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .stat:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .stat-value {
            display: block;
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--gray-color);
            font-weight: 600;
        }

        /* FIXED TEXT DISPLAY WITH AUTO-SCROLL */
        .text-display {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 40px;
            margin-bottom: 25px;
            font-size: 1.3rem;
            line-height: 2;
            min-height: 300px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            backdrop-filter: blur(10px);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
            position: relative;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            scroll-behavior: smooth;
        }

        .text-display .correct {
            background-color: rgba(16, 185, 129, 0.3);
            color: var(--success-color);
            font-weight: 600;
        }

        .text-display .incorrect {
            background-color: rgba(239, 68, 68, 0.3);
            color: var(--error-color);
            font-weight: 600;
        }

        .text-display .current {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            animation: pulse 1s infinite;
            font-weight: 600;
            position: relative;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        #typingInput {
            width: 100%;
            padding: 25px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 150px;
            margin-bottom: 25px;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        #typingInput:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            background: white;
        }

        .test-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        /* Test Mode Info */
        .test-mode-info {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .test-mode-info h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .test-mode-info p {
            color: var(--gray-color);
            font-size: 0.95rem;
        }

        /* Buttons */
        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--gray-color), #475569);
            color: white;
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.6);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 700px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideInScale 0.4s ease;
        }

        @keyframes slideInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 35px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        }

        .modal-header h2 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--gray-color);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 35px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 35px;
        }

        .result-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            border: 2px solid var(--border-color);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .result-value {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .result-label {
            color: var(--gray-color);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .performance-rating {
            text-align: center;
            padding: 25px;
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            border-radius: var(--border-radius);
            margin-bottom: 35px;
            font-size: 1.3rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .performance-rating i {
            margin-right: 12px;
            font-size: 1.8rem;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 3px;
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 12px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 8px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Certificates and Leaderboard styles */
        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .certificates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .certificate-card {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .certificate-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--gray-color);
        }

        .empty-state i {
            font-size: 5rem;
            margin-bottom: 25px;
            color: var(--border-color);
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 150px 120px;
            gap: 20px;
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .leaderboard-body {
            max-height: 500px;
            overflow-y: auto;
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 150px 120px;
            gap: 20px;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .leaderboard-row:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .rank {
            font-weight: 800;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        /* Loading animation */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(99, 102, 241, 0.1);
            border-left: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Certificate generation loading */
        .generating-cert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            text-align: center;
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 25px;
                text-align: center;
            }
            
            .test-controls {
                grid-template-columns: 1fr;
            }
            
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .leaderboard-header,
            .leaderboard-row {
                grid-template-columns: 50px 1fr 80px 80px 100px 80px;
                gap: 10px;
                font-size: 0.9rem;
                padding: 15px 20px;
            }
            
            .test-header h2 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="background-elements">
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-keyboard"></i>
                <h1>TypeMaster Pro</h1>
            </div>
            <nav class="nav">
                <button class="nav-btn active" data-mode="typing">Typing Test</button>
                <button class="nav-btn" data-mode="certificates">Certificates</button>
                <button class="nav-btn" data-mode="leaderboard">Leaderboard</button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="main">
            <!-- Typing Test Section -->
            <section id="typing-section" class="section active">
                <div class="test-header">
                    <h2>Advanced Typing Test</h2>
                    <p>Challenge yourself with paragraphs and custom durations!</p>
                </div>

                <div class="test-controls">
                    <div class="control-group">
                        <label><i class="fas fa-clock"></i> Test Duration</label>
                        <select id="timeSelect">
                            <option value="60">1 minute</option>
                            <option value="120">2 minutes</option>
                            <option value="300">5 minutes</option>
                            <option value="600">10 minutes</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label><i class="fas fa-layer-group"></i> Test Mode</label>
                        <select id="modeSelect">
                            <option value="paragraph1">1 Paragraph</option>
                            <option value="paragraph2">2 Paragraphs</option>
                            <option value="timed">Timed Challenge</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label><i class="fas fa-chart-line"></i> Difficulty</label>
                        <select id="difficultySelect">
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                </div>

                <div id="testModeInfo" class="test-mode-info">
                    <h3>Selected Mode: 1 Paragraph</h3>
                    <p>Type one complete paragraph accurately. The test ends when you finish the paragraph or make too many errors.</p>
                </div>

                <div class="typing-area">
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>

                    <div class="stats-bar">
                        <div class="stat">
                            <span class="stat-value" id="wpm">0</span>
                            <span class="stat-label">WPM</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="accuracy">100%</span>
                            <span class="stat-label">Accuracy</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="timer">60</span>
                            <span class="stat-label">Time Left</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="characters">0</span>
                            <span class="stat-label">Characters</span>
                        </div>
                    </div>

                    <div class="text-display" id="textDisplay">
                        Select your preferences and click "Start Test" to begin your typing challenge!
                    </div>

                    <textarea id="typingInput" placeholder="Start typing here when the test begins..." disabled></textarea>

                    <div class="test-buttons">
                        <button id="startBtn" class="btn btn-primary">
                            <i class="fas fa-play"></i> Start Test
                        </button>
                        <button id="resetBtn" class="btn btn-secondary">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>

                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p>Preparing your test...</p>
                </div>
            </section>

            <!-- Results Modal -->
            <div id="resultsModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2><i class="fas fa-trophy"></i> Test Results</h2>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="results-grid">
                            <div class="result-card">
                                <div class="result-value" id="finalWPM">0</div>
                                <div class="result-label">Words Per Minute</div>
                            </div>
                            <div class="result-card">
                                <div class="result-value" id="finalAccuracy">0%</div>
                                <div class="result-label">Accuracy</div>
                            </div>
                            <div class="result-card">
                                <div class="result-value" id="finalErrors">0</div>
                                <div class="result-label">Total Errors</div>
                            </div>
                            <div class="result-card">
                                <div class="result-value" id="finalTime">0s</div>
                                <div class="result-label">Duration</div>
                            </div>
                        </div>
                        <div class="performance-rating" id="performanceRating">
                            <i class="fas fa-trophy"></i>
                            <span>Excellent Performance!</span>
                        </div>
                        <div class="modal-actions">
                            <button id="certificateBtn" class="btn btn-primary">
                                <i class="fas fa-file-pdf"></i> Download PDF Certificate
                            </button>
                            <button id="retryBtn" class="btn btn-secondary">
                                <i class="fas fa-redo"></i> Try Again
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Certificates Section -->
            <section id="certificates-section" class="section">
                <div class="section-header">
                    <h2>My Certificates</h2>
                    <p>Your typing achievements and certifications</p>
                </div>
                <div id="certificatesList" class="certificates-grid">
                    <div class="empty-state">
                        <i class="fas fa-certificate"></i>
                        <p>No certificates yet. Complete a typing test to earn your first certificate!</p>
                    </div>
                </div>
            </section>

            <!-- Leaderboard Section -->
            <section id="leaderboard-section" class="section">
                <div class="section-header">
                    <h2>Global Leaderboard</h2>
                    <p>Top performers across all typing modes</p>
                </div>
                <div class="leaderboard">
                    <div class="leaderboard-header">
                        <div>Rank</div>
                        <div>Name</div>
                        <div>WPM</div>
                        <div>Accuracy</div>
                        <div>Mode</div>
                        <div>Date</div>
                    </div>
                    <div id="leaderboardList" class="leaderboard-body">
                        <!-- Leaderboard entries will be populated by JavaScript -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Certificate Generation Loading -->
    <div id="certificateLoading" class="generating-cert">
        <div class="spinner"></div>
        <p>Generating your PDF certificate...</p>
    </div>

    <script>
        class AdvancedTypingTest {
            constructor() {
                this.testTexts = {
                    easy: {
                        paragraph1: [
                            "The sun rises in the east and sets in the west. This is a basic fact that everyone knows. Birds fly in the sky and fish swim in the water. Life is simple when we understand the basics. Nature provides us with everything we need to survive and thrive."
                        ],
                        paragraph2: [
                            "The sun rises in the east and sets in the west. This is a basic fact that everyone knows. Birds fly in the sky and fish swim in the water. Life is simple when we understand the basics.\n\nNature has its own rhythm and flow. Trees grow tall and flowers bloom in spring. Rain falls from the clouds and rivers flow to the sea. Everything in nature works together in perfect harmony."
                        ],
                        timed: [
                            "The quick brown fox jumps over the lazy dog. This sentence contains all letters of the alphabet. It is commonly used for typing practice. The weather is nice today and the sun is shining bright. Children are playing in the park while their parents watch them carefully. Simple sentences help us learn to type faster and more accurately. Practice makes perfect when it comes to developing typing skills."
                        ]
                    },
                    medium: {
                        paragraph1: [
                            "Technology has revolutionized the way we communicate and work in the modern world. Smartphones, computers, and the internet have made it possible to connect with people across the globe instantly. However, this digital transformation also brings challenges such as information overload, privacy concerns, and the need for continuous digital literacy development."
                        ],
                        paragraph2: [
                            "Technology has revolutionized the way we communicate and work in the modern world. Smartphones, computers, and the internet have made it possible to connect with people across the globe instantly. However, this digital transformation also brings challenges such as information overload and the need for digital literacy.\n\nThe workplace has evolved dramatically with remote work becoming increasingly common. Video conferences replace face-to-face meetings, and cloud storage allows teams to collaborate from different locations. This shift requires new skills in time management, self-discipline, and virtual communication."
                        ],
                        timed: [
                            "Programming languages like Python, JavaScript, and Java have become essential tools in software development. Each language has its unique strengths and applications. Python is known for its simplicity and readability, making it perfect for beginners and data science. JavaScript powers the modern web, enabling interactive websites and applications. Understanding these technologies opens doors to exciting career opportunities in the digital age."
                        ]
                    },
                    hard: {
                        paragraph1: [
                            "Quantum mechanics fundamentally challenges our understanding of reality through concepts like superposition and entanglement. The Copenhagen interpretation suggests that particles exist in multiple states simultaneously until observation collapses the wave function, leading to philosophical debates about the nature of measurement, consciousness, and the role of the observer in quantum systems."
                        ],
                        paragraph2: [
                            "Quantum mechanics fundamentally challenges our understanding of reality through concepts like superposition and entanglement. The Copenhagen interpretation suggests that particles exist in multiple states simultaneously until observation collapses the wave function, leading to philosophical debates about the nature of measurement and consciousness in quantum systems.\n\nCryptographic protocols in cybersecurity rely on mathematical complexity to ensure data integrity and confidentiality. Advanced encryption algorithms like AES-256 and RSA utilize prime factorization and elliptic curve cryptography to create virtually unbreakable security barriers, protecting sensitive information in our interconnected digital infrastructure."
                        ],
                        timed: [
                            "Artificial intelligence algorithms process vast datasets through neural networks inspired by biological brain structures. Machine learning models use statistical methods to identify patterns and make predictions without explicit programming. Deep learning architectures with multiple hidden layers can recognize complex features in images, understand natural language, and even generate creative content like art and music."
                        ]
                    },
                    expert: {
                        paragraph1: [
                            "Neuroplasticity encompasses the brain's extraordinary capacity for structural and functional reorganization throughout the lifespan, involving synaptic pruning, dendritic arborization, and neurogenesis in response to experiential demands, pharmacological interventions, and pathological conditions, thereby challenging traditional neuroscientific paradigms regarding cortical immutability and cognitive flexibility."
                        ],
                        paragraph2: [
                            "Neuroplasticity encompasses the brain's extraordinary capacity for structural and functional reorganization throughout the lifespan, involving synaptic pruning, dendritic arborization, and neurogenesis in response to experiential demands, pharmacological interventions, and pathological conditions, thereby challenging traditional neuroscientific paradigms regarding cortical immutability.\n\nQuantum computational algorithms leverage superposition, entanglement, and quantum interference phenomena to achieve exponential speedup over classical counterparts in specific problem domains, including Shor's factorization algorithm, Grover's search optimization, and variational quantum eigensolvers for molecular simulation and cryptanalytic applications."
                        ],
                        timed: [
                            "Bioinformatics methodologies integrate computational linguistics, statistical modeling, and algorithmic complexity theory to analyze genomic sequences, protein folding dynamics, and phylogenetic relationships. These interdisciplinary approaches utilize high-performance computing clusters and distributed processing frameworks to handle petabyte-scale biological datasets, enabling breakthrough discoveries in personalized medicine and evolutionary biology."
                        ]
                    }
                };

                this.isTestActive = false;
                this.startTime = null;
                this.endTime = null;
                this.currentText = '';
                this.userInput = '';
                this.timeLeft = 60;
                this.timerInterval = null;
                this.currentIndex = 0;
                this.errors = 0;
                this.totalCharacters = 0;

                this.certificates = JSON.parse(localStorage.getItem('typingCertificates')) || [];
                this.leaderboard = JSON.parse(localStorage.getItem('typingLeaderboard')) || [];

                this.initializeElements();
                this.attachEventListeners();
                this.updateLeaderboard();
                this.updateTimer();
                this.updateModeInfo();
            }

            initializeElements() {
                this.elements = {
                    // Navigation
                    navBtns: document.querySelectorAll('.nav-btn'),
                    sections: document.querySelectorAll('.section'),
                    
                    // Test elements
                    timeSelect: document.getElementById('timeSelect'),
                    modeSelect: document.getElementById('modeSelect'),
                    difficultySelect: document.getElementById('difficultySelect'),
                    textDisplay: document.getElementById('textDisplay'),
                    typingInput: document.getElementById('typingInput'),
                    startBtn: document.getElementById('startBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    loadingIndicator: document.getElementById('loadingIndicator'),
                    progressBar: document.getElementById('progressBar'),
                    testModeInfo: document.getElementById('testModeInfo'),
                    
                    // Stats
                    wpmDisplay: document.getElementById('wpm'),
                    accuracyDisplay: document.getElementById('accuracy'),
                    timerDisplay: document.getElementById('timer'),
                    charactersDisplay: document.getElementById('characters'),
                    
                    // Modal
                    resultsModal: document.getElementById('resultsModal'),
                    modalClose: document.querySelector('.modal-close'),
                    finalWPM: document.getElementById('finalWPM'),
                    finalAccuracy: document.getElementById('finalAccuracy'),
                    finalErrors: document.getElementById('finalErrors'),
                    finalTime: document.getElementById('finalTime'),
                    performanceRating: document.getElementById('performanceRating'),
                    certificateBtn: document.getElementById('certificateBtn'),
                    retryBtn: document.getElementById('retryBtn'),
                    
                    // Other sections
                    certificatesList: document.getElementById('certificatesList'),
                    leaderboardList: document.getElementById('leaderboardList'),
                    certificateLoading: document.getElementById('certificateLoading')
                };
            }

            attachEventListeners() {
                // Navigation
                this.elements.navBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchSection(e.target.dataset.mode));
                });

                // Test controls
                this.elements.startBtn.addEventListener('click', () => this.startTest());
                this.elements.resetBtn.addEventListener('click', () => this.resetTest());
                this.elements.typingInput.addEventListener('input', () => this.handleInput());
                this.elements.timeSelect.addEventListener('change', () => this.updateTimer());
                this.elements.modeSelect.addEventListener('change', () => this.updateModeInfo());

                // Modal
                this.elements.modalClose.addEventListener('click', () => this.closeModal());
                this.elements.certificateBtn.addEventListener('click', () => this.generateCertificate());
                this.elements.retryBtn.addEventListener('click', () => {
                    this.closeModal();
                    this.resetTest();
                });

                // Close modal on outside click
                this.elements.resultsModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.resultsModal) {
                        this.closeModal();
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter' && !this.isTestActive) {
                        this.startTest();
                    }
                    if (e.key === 'Escape') {
                        this.closeModal();
                    }
                });
            }

            switchSection(mode) {
                // Update navigation
                this.elements.navBtns.forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

                // Update sections
                this.elements.sections.forEach(section => section.classList.remove('active'));
                document.getElementById(`${mode}-section`).classList.add('active');

                // Load section-specific content
                if (mode === 'certificates') {
                    this.displayCertificates();
                } else if (mode === 'leaderboard') {
                    this.updateLeaderboard();
                }
            }

            updateTimer() {
                this.timeLeft = parseInt(this.elements.timeSelect.value);
                this.elements.timerDisplay.textContent = this.timeLeft;
            }

            updateModeInfo() {
                const mode = this.elements.modeSelect.value;
                const modeInfo = {
                    'paragraph1': {
                        title: '1 Paragraph Mode',
                        description: 'Type one complete paragraph accurately. The test ends when you finish the paragraph or make too many errors.'
                    },
                    'paragraph2': {
                        title: '2 Paragraphs Mode', 
                        description: 'Type two complete paragraphs with a line break between them. Focus on maintaining accuracy across longer text.'
                    },
                    'timed': {
                        title: 'Timed Challenge',
                        description: 'Type continuously for the selected duration. New text will appear as you complete sections. Focus on speed and accuracy!'
                    }
                };

                const info = modeInfo[mode];
                this.elements.testModeInfo.innerHTML = `
                    <h3>Selected Mode: ${info.title}</h3>
                    <p>${info.description}</p>
                `;
            }

            async startTest() {
                this.elements.loadingIndicator.style.display = 'block';
                
                // Simulate loading time for better UX
                await new Promise(resolve => setTimeout(resolve, 800));
                
                this.elements.loadingIndicator.style.display = 'none';

                this.isTestActive = true;
                this.startTime = new Date();
                this.currentIndex = 0;
                this.errors = 0;
                this.userInput = '';
                this.totalCharacters = 0;

                // Get text based on difficulty and mode
                const difficulty = this.elements.difficultySelect.value;
                const mode = this.elements.modeSelect.value;
                const texts = this.testTexts[difficulty][mode];
                this.currentText = texts[Math.floor(Math.random() * texts.length)];

                // Update UI
                this.elements.textDisplay.innerHTML = this.currentText;
                this.elements.typingInput.value = '';
                this.elements.typingInput.disabled = false;
                this.elements.typingInput.focus();
                this.elements.startBtn.disabled = true;
                this.elements.progressBar.style.width = '0%';

                // Start timer
                this.timeLeft = parseInt(this.elements.timeSelect.value);
                this.timerInterval = setInterval(() => {
                    this.timeLeft--;
                    this.elements.timerDisplay.textContent = this.timeLeft;
                    
                    // Update progress bar
                    const totalTime = parseInt(this.elements.timeSelect.value);
                    const progress = ((totalTime - this.timeLeft) / totalTime) * 100;
                    this.elements.progressBar.style.width = `${progress}%`;
                    
                    if (this.timeLeft <= 0) {
                        this.endTest();
                    }
                }, 1000);
            }

            handleInput() {
                if (!this.isTestActive) return;

                this.userInput = this.elements.typingInput.value;
                this.currentIndex = this.userInput.length;
                this.totalCharacters = this.userInput.length;

                // Update display with fixed highlighting and auto-scroll
                this.highlightText();
                this.autoScroll();
                
                // Update stats
                this.updateStats();

                // Check if test is complete (for paragraph modes)
                const mode = this.elements.modeSelect.value;
                if ((mode === 'paragraph1' || mode === 'paragraph2') && this.userInput.trim() === this.currentText.trim()) {
                    this.endTest();
                }

                // For timed mode, provide new text when current is nearly complete
                if (mode === 'timed' && this.userInput.length >= this.currentText.length - 10) {
                    const difficulty = this.elements.difficultySelect.value;
                    const texts = this.testTexts[difficulty][mode];
                    this.currentText += ' ' + texts[Math.floor(Math.random() * texts.length)];
                    this.highlightText();
                }
            }

            highlightText() {
                let result = '';
                let errorCount = 0;

                for (let i = 0; i < this.currentText.length; i++) {
                    const char = this.currentText[i];
                    
                    if (i < this.userInput.length) {
                        if (this.userInput[i] === char) {
                            result += `<span class="correct">${char === '\n' ? '<br>' : (char === ' ' ? '&nbsp;' : char)}</span>`;
                        } else {
                            result += `<span class="incorrect">${char === '\n' ? '<br>' : (char === ' ' ? '&nbsp;' : char)}</span>`;
                            errorCount++;
                        }
                    } else if (i === this.userInput.length && i < this.currentText.length) {
                        result += `<span class="current" id="currentChar">${char === '\n' ? '<br>' : (char === ' ' ? '&nbsp;' : char)}</span>`;
                    } else {
                        result += char === '\n' ? '<br>' : (char === ' ' ? '&nbsp;' : char);
                    }
                }

                this.errors = errorCount;
                this.elements.textDisplay.innerHTML = result;
            }

            // AUTO-SCROLL FUNCTIONALITY
            autoScroll() {
                const textDisplay = this.elements.textDisplay;
                const currentChar = document.getElementById('currentChar');
                
                if (currentChar) {
                    const textDisplayRect = textDisplay.getBoundingClientRect();
                    const currentCharRect = currentChar.getBoundingClientRect();
                    
                    // Check if current character is near the bottom of the visible area
                    const threshold = textDisplayRect.height * 0.8; // Scroll when 80% down
                    const relativePosition = currentCharRect.top - textDisplayRect.top;
                    
                    if (relativePosition > threshold) {
                        // Smooth scroll to keep current character in view
                        const scrollAmount = relativePosition - (textDisplayRect.height * 0.3);
                        textDisplay.scrollTop += scrollAmount;
                    }
                }
            }

            updateStats() {
                if (!this.startTime) return;

                const timeElapsed = (new Date() - this.startTime) / 1000 / 60; // in minutes
                const wordsTyped = this.userInput.trim().split(/\s+/).filter(word => word.length > 0).length;
                const wpm = Math.round(wordsTyped / timeElapsed) || 0;
                const accuracy = this.userInput.length > 0 ? 
                    Math.round(((this.userInput.length - this.errors) / this.userInput.length) * 100) : 100;

                this.elements.wpmDisplay.textContent = wpm;
                this.elements.accuracyDisplay.textContent = `${accuracy}%`;
                this.elements.charactersDisplay.textContent = this.totalCharacters;
            }

            endTest() {
                this.isTestActive = false;
                this.endTime = new Date();
                clearInterval(this.timerInterval);

                this.elements.typingInput.disabled = true;
                this.elements.startBtn.disabled = false;
                this.elements.progressBar.style.width = '100%';

                this.showResults();
            }

            showResults() {
                const timeElapsed = (this.endTime - this.startTime) / 1000;
                const wordsTyped = this.userInput.trim().split(/\s+/).filter(word => word.length > 0).length;
                const wpm = Math.round((wordsTyped / timeElapsed) * 60);
                const accuracy = this.userInput.length > 0 ? 
                    Math.round(((this.userInput.length - this.errors) / this.userInput.length) * 100) : 0;

                // FIXED: Corrected typo wmp -> wpm
                this.elements.finalWPM.textContent = wpm;
                this.elements.finalAccuracy.textContent = `${accuracy}%`;
                this.elements.finalErrors.textContent = this.errors;
                this.elements.finalTime.textContent = `${Math.round(timeElapsed)}s`;

                // Performance rating
                let rating = '';
                let ratingIcon = '';
                if (wpm >= 100) {
                    rating = 'Legendary Typist! 🚀';
                    ratingIcon = 'fas fa-rocket';
                } else if (wpm >= 80) {
                    rating = 'Outstanding Performance! 🏆';
                    ratingIcon = 'fas fa-trophy';
                } else if (wpm >= 60) {
                    rating = 'Excellent Work! 🌟';
                    ratingIcon = 'fas fa-star';
                } else if (wpm >= 40) {
                    rating = 'Good Progress! 👍';
                    ratingIcon = 'fas fa-thumbs-up';
                } else if (wpm >= 20) {
                    rating = 'Keep Practicing! 💪';
                    ratingIcon = 'fas fa-dumbbell';
                } else {
                    rating = 'Great Start! 📚';
                    ratingIcon = 'fas fa-book';
                }

                this.elements.performanceRating.innerHTML = `<i class="${ratingIcon}"></i><span>${rating}</span>`;

                // Store result for leaderboard
                const result = {
                    wpm: wpm,
                    accuracy: accuracy,
                    errors: this.errors,
                    time: Math.round(timeElapsed),
                    difficulty: this.elements.difficultySelect.value,
                    mode: this.elements.modeSelect.value,
                    date: new Date().toLocaleDateString(),
                    timestamp: new Date().getTime(),
                    characters: this.totalCharacters
                };

                this.updateLeaderboardData(result);
                this.elements.resultsModal.style.display = 'block';
            }

            updateLeaderboardData(result) {
                this.leaderboard.push({
                    name: `User${Math.floor(Math.random() * 1000)}`,
                    ...result
                });

                // Sort by WPM and keep top 20
                this.leaderboard.sort((a, b) => b.wpm - a.wpm);
                this.leaderboard = this.leaderboard.slice(0, 20);

                localStorage.setItem('typingLeaderboard', JSON.stringify(this.leaderboard));
                this.updateLeaderboard();
            }

            updateLeaderboard() {
                if (this.leaderboard.length === 0) {
                    this.elements.leaderboardList.innerHTML = '<div class="empty-state"><i class="fas fa-chart-line"></i><p>No records yet. Complete a typing test to appear on the leaderboard!</p></div>';
                    return;
                }

                this.elements.leaderboardList.innerHTML = this.leaderboard.map((entry, index) => `
                    <div class="leaderboard-row">
                        <div class="rank">#${index + 1}</div>
                        <div>${entry.name}</div>
                        <div>${entry.wpm} WPM</div>
                        <div>${entry.accuracy}%</div>
                        <div>${entry.mode} (${entry.difficulty})</div>
                        <div>${entry.date}</div>
                    </div>
                `).join('');
            }

            // COMPLETELY FIXED PDF CERTIFICATE GENERATION
            async generateCertificate() {
                try {
                    // Show loading indicator
                    this.elements.certificateLoading.style.display = 'block';

                    const wpm = parseInt(this.elements.finalWPM.textContent);
                    const accuracy = parseInt(this.elements.finalAccuracy.textContent);
                    const date = new Date().toLocaleDateString();
                    const mode = this.elements.modeSelect.value;
                    const difficulty = this.elements.difficultySelect.value;

                    const certificate = {
                        id: Date.now(),
                        wpm: wpm,  // FIXED: Corrected wmp -> wpm
                        accuracy: accuracy,
                        date: date,
                        difficulty: difficulty,
                        mode: mode,
                        type: wpm >= 80 ? 'Excellence' : wpm >= 60 ? 'Proficiency' : wpm >= 40 ? 'Achievement' : 'Participation'
                    };

                    this.certificates.push(certificate);
                    localStorage.setItem('typingCertificates', JSON.stringify(this.certificates));

                    // Wait for PDF generation
                    await this.createPDFCertificate(certificate);
                    
                    // Hide loading indicator
                    this.elements.certificateLoading.style.display = 'none';
                    this.closeModal();
                    
                    // Show success message
                    alert('🎉 PDF Certificate generated successfully and downloaded!');

                } catch (error) {
                    console.error('Certificate generation error:', error);
                    this.elements.certificateLoading.style.display = 'none';
                    alert('❌ Error generating certificate. Please try again.');
                }
            }

            // WORKING PDF CERTIFICATE CREATION
            async createPDFCertificate(cert) {
                return new Promise((resolve, reject) => {
                    try {
                        // Check if jsPDF is loaded
                        if (typeof window.jspdf === 'undefined') {
                            throw new Error('jsPDF library not loaded properly');
                        }

                        const { jsPDF } = window.jspdf;
                        
                        // Create new PDF document
                        const doc = new jsPDF({
                            orientation: 'landscape',
                            unit: 'mm',
                            format: 'a4'
                        });

                        // Add background colors
                        doc.setFillColor(102, 126, 234);
                        doc.rect(0, 0, 297, 210, 'F');

                        doc.setFillColor(139, 92, 246);
                        doc.rect(20, 20, 257, 170, 'F');

                        // White certificate area
                        doc.setFillColor(255, 255, 255);
                        doc.rect(30, 30, 237, 150, 'F');

                        // Border
                        doc.setDrawColor(102, 126, 234);
                        doc.setLineWidth(2);
                        doc.rect(35, 35, 227, 140);

                        // Certificate content
                        doc.setTextColor(102, 126, 234);
                        doc.setFontSize(28);
                        doc.setFont('helvetica', 'bold');
                        doc.text('CERTIFICATE OF ' + cert.type.toUpperCase(), 148.5, 65, { align: 'center' });

                        doc.setFontSize(16);
                        doc.setFont('helvetica', 'normal');
                        doc.text('TypeMaster Pro - Advanced Typing Test', 148.5, 80, { align: 'center' });

                        doc.setFontSize(14);
                        doc.text('This certifies exceptional typing performance:', 148.5, 100, { align: 'center' });

                        // Main stats
                        doc.setTextColor(255, 215, 0);
                        doc.setFontSize(24);
                        doc.setFont('helvetica', 'bold');
                        doc.text(`${cert.wpm} WPM`, 148.5, 120, { align: 'center' });

                        doc.setTextColor(102, 126, 234);
                        doc.setFontSize(14);
                        doc.setFont('helvetica', 'normal');
                        doc.text(`${cert.accuracy}% Accuracy`, 148.5, 135, { align: 'center' });

                        // Additional details
                        const modeText = cert.mode === 'paragraph1' ? '1 Paragraph' : 
                                       cert.mode === 'paragraph2' ? '2 Paragraphs' : 'Timed Challenge';
                        const difficultyText = cert.difficulty.charAt(0).toUpperCase() + cert.difficulty.slice(1);
                        doc.text(`Mode: ${modeText} | Difficulty: ${difficultyText}`, 148.5, 150, { align: 'center' });

                        // Date and authority
                        doc.setFontSize(12);
                        doc.text(`Achieved on ${cert.date}`, 148.5, 165, { align: 'center' });

                        doc.setFont('helvetica', 'italic');
                        doc.setFontSize(10);
                        doc.text('TypeMaster Pro Certification Authority', 148.5, 175, { align: 'center' });

                        // Generate unique filename and save
                        const filename = `TypeMaster-Certificate-${cert.id}-${cert.wpm}WPM.pdf`;
                        doc.save(filename);
                        
                        resolve();

                    } catch (error) {
                        console.error('PDF creation error:', error);
                        reject(error);
                    }
                });
            }

            displayCertificates() {
                if (this.certificates.length === 0) {
                    this.elements.certificatesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-certificate"></i>
                            <p>No certificates yet. Complete a typing test to earn your first certificate!</p>
                        </div>
                    `;
                    return;
                }

                this.elements.certificatesList.innerHTML = this.certificates.map(cert => `
                    <div class="certificate-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="color: var(--primary-color); font-weight: 700;">Certificate of ${cert.type}</h3>
                            <span style="color: var(--gray-color); font-size: 0.9rem;">${cert.date}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="text-align: center; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 8px;">
                                <strong style="display: block; font-size: 1.8rem; color: var(--primary-color);">${cert.wpm}</strong>
                                <span style="color: var(--gray-color);">WPM</span>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                                <strong style="display: block; font-size: 1.8rem; color: var(--success-color);">${cert.accuracy}%</strong>
                                <span style="color: var(--gray-color);">Accuracy</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px; color: var(--gray-color);">
                            <p><strong>Mode:</strong> ${cert.mode === 'paragraph1' ? '1 Paragraph' : cert.mode === 'paragraph2' ? '2 Paragraphs' : 'Timed Challenge'}</p>
                            <p><strong>Difficulty:</strong> ${cert.difficulty}</p>
                        </div>
                        <button class="btn btn-secondary" onclick="app.redownloadCertificate(${cert.id})" style="width: 100%;">
                            <i class="fas fa-file-pdf"></i> Download PDF Certificate
                        </button>
                    </div>
                `).join('');
            }

            async redownloadCertificate(id) {
                const cert = this.certificates.find(c => c.id === id);
                if (cert) {
                    try {
                        this.elements.certificateLoading.style.display = 'block';
                        await this.createPDFCertificate(cert);
                        this.elements.certificateLoading.style.display = 'none';
                        alert('🎉 Certificate downloaded successfully!');
                    } catch (error) {
                        console.error('Download error:', error);
                        this.elements.certificateLoading.style.display = 'none';
                        alert('❌ Error downloading certificate. Please try again.');
                    }
                }
            }

            resetTest() {
                this.isTestActive = false;
                this.startTime = null;
                this.endTime = null;
                this.currentText = '';
                this.userInput = '';
                this.currentIndex = 0;
                this.errors = 0;
                this.totalCharacters = 0;

                clearInterval(this.timerInterval);

                this.elements.textDisplay.innerHTML = 'Select your preferences and click "Start Test" to begin your typing challenge!';
                this.elements.typingInput.value = '';
                this.elements.typingInput.disabled = true;
                this.elements.startBtn.disabled = false;
                this.elements.progressBar.style.width = '0%';
                
                this.updateTimer();
                this.elements.wpmDisplay.textContent = '0';
                this.elements.accuracyDisplay.textContent = '100%';
                this.elements.charactersDisplay.textContent = '0';
            }

            closeModal() {
                this.elements.resultsModal.style.display = 'none';
            }
        }

        // Initialize the application when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            window.app = new AdvancedTypingTest();

            // Add some sample data to leaderboard for demonstration
            if (app.leaderboard.length === 0) {
                const sampleData = [
                    { name: 'SpeedDemon', wpm: 120, accuracy: 98, mode: 'timed', difficulty: 'expert', date: '2024-01-15' },
                    { name: 'TypingMaster', wpm: 105, accuracy: 96, mode: 'paragraph2', difficulty: 'hard', date: '2024-01-14' },
                    { name: 'KeyboardWarrior', wpm: 95, accuracy: 94, mode: 'paragraph1', difficulty: 'medium', date: '2024-01-13' },
                    { name: 'FastFingers', wpm: 87, accuracy: 92, mode: 'timed', difficulty: 'medium', date: '2024-01-12' },
                    { name: 'QuickType', wpm: 78, accuracy: 89, mode: 'paragraph2', difficulty: 'easy', date: '2024-01-11' }
                ];
                
                app.leaderboard = sampleData;
                localStorage.setItem('typingLeaderboard', JSON.stringify(sampleData));
                app.updateLeaderboard();
            }
        });
    </script>
</body>
</html>
